'use strict';(()=>{let vue_config={data(){return{current_time:new Date().getTime(),tron:{tronWeb:false,auth:false,account:''},launch_date:1633420800000,until_launch:0,initialized:0,public:1};},created(){console.log("App initialising..");let self=this,tries=0;setTimeout(function tronCheck(){let tw=window.tronWeb;if(!tw){if(++tries<30){setTimeout(tronCheck,100);return;}else{console.log("Public Mode");self.tron.tronWeb=new TronWeb({fullHost:"https:\/\/api.trongrid.io"});self.public=1;self.initialized=1;return;}};self.tron.tronWeb=tw;tw.on("addressChanged",()=>{if(self.public==1&&!!tw.defaultAddress){tw=window.tronWeb;self.public=0;self.tron.tronWeb=window.tronWeb;self.getTronWeb().then(async tw=>{self.trsc=await tw.contract().at(self.contract_address);console.log("Late Authorization");});};self.tron.account=tw.defaultAddress.base58;console.log("Address: "+self.tron.account);});tries=0;setTimeout(function authCheck(){self.tron.auth=tw&&tw.ready;if(++tries<30){if(!self.tron.auth){console.log("Waiting for authorization...");setTimeout(authCheck,100);}else{console.log("Authorized");self.tron.account=tw.defaultAddress.base58;self.public=0;self.initialized=1;}}else{console.log("Unauthorized Mode");self.tron.tronWeb=new TronWeb({fullHost:"https:\/\/api.shasta.trongrid.io"});self.public=1;self.initialized=1;return;}},200);},100);setInterval(()=>{self.currentTime();},250);},methods:{currentTime(){this.current_time=new Date().getTime();this.until_launch=this.launch_date-this.current_time;return new Date().getTime()/1e3;},getTronWeb(){let self=this;return new Promise((resolve,reject)=>{resolve(self.tron.tronWeb);});}}};window.App=new Vue({mixins:[vue_config],el:'#root',data:{trsc:{},contract_address:'TXiyNxbxrVtW6AHufuNSMXo3xBf19PJLsQ',contract:{totalDeposits:0,totalWithdrawals:0,totalRefBonus:0,totalUsers:0,balance:0},user:{ref:"TXiyNxbxrVtW6AHufuNSMXo3xBf19PJLsQ",wallet:0,totalDeposits:0,totalWithdrawn:0,totalWithdrawable:0,depositCount:0,dailyRate:0,bonus:0,totalBonus:0,totalReferrals:0,referrals:[0,0,0,0,0],lastWithdraw:0,deposits:[]},userRequests:0,userTimeouts:{},contractRequests:0,contractTimeouts:{},calc:{plan1:200,plan2:200,plan3:500,plan4:500,max:100000},pages:{deposits:0},notifications:[]},mounted(){let self=this;let m=location.search.match(/ref=(T[1-9A-HJ-NP-Za-km-z]{33})/i);if(m){self.user.ref=m[1];document.cookie="ref="+self.user.ref+"; path=/; expires="+(new Date(new Date().getTime()+86400*365*1000)).toUTCString();};m=document.cookie.match(/ref=(T[1-9A-HJ-NP-Za-km-z]{33})/i);if(m)self.user.ref=m[1];setTimeout(function configure(){console.log("Loading..."+self.initialized);if(!self.initialized){return setTimeout(configure,400);};self.getTronWeb().then(async tw=>{self.trsc=await tw.contract().at(self.contract_address);console.log("Contract connected");setInterval(()=>{try{self.fetchData();}catch(e){console.log(e)}},3000);self.fetchData();});},100);const prefersDarkScheme=window.matchMedia("(prefers-color-scheme: dark)");const currentTheme=localStorage.getItem("theme");if(currentTheme==null){if(prefersDarkScheme.matches){document.body.classList.toggle("dark-mode");}}else if(currentTheme=="dark"){document.body.classList.toggle("dark-mode");};self.getUserDeposits();},watch:{'tron.account'(){this.tron.account=window.tronWeb.defaultAddress.base58;}},methods:{notice(msg,color='c2e93c',time=3000){return new Promise((resolve,reject)=>{let wrap=$('<div style="position:fixed; left:calc(50% - 150px); box-shadow:0 5px 25px rgba(0,0,0,0.2); width:320px; top:40px; background:#'+(color?color:'653aba')+'; border-radius:10px; color:#fff; padding:20px 20px; font:14px/1.2 Tahoma, sans-serif; cursor:pointer; z-index:999999; text-align:center;">'+msg+'</div>').on('click',()=>{wrap.remove();resolve();}).appendTo('body');if(time)setTimeout(()=>{wrap.remove();},time);});},notify(title,content='',timeout=7e3){let self=this;if(content==''){content=title;title='';};self.notifications.push({expiresOn:self.current_time+timeout,title:title,content:content});for(let i=0;i<self.notifications.length;i++){if(self.notifications[i].expiresOn<=self.current_time){self.notifications.splice(i,1);i--;}}},connectWallet(){let self=this;let tw=window.tronWeb;if(!tw){console.log("Public Mode");self.tron.tronWeb=new TronWeb({fullHost:"https:\/\/api.shasta.trongrid.io"});self.public=1;return;}else{tw.request({method:'tron_requestAccounts'});console.log("Private Mode");self.tron.tronWeb=tw;self.public=0;}},closeNotif(index){let self=this;self.notifications.splice(index,1);},expandContents(e){let self=this;e.target.parentElement.classList.remove("expanded");e.target.parentElement.classList.add("expanded");e.target.remove();},toggleTheme(){document.body.classList.toggle("dark-mode");var theme=document.body.classList.contains("dark-mode")?"dark":"light";localStorage.setItem("theme",theme);},copyRef(){let self=this;let s=document.createElement('input');s.value="https:\/\/tronfold.com/?ref="+self.tron.account;document.body.appendChild(s);if(navigator.userAgent.match(/ipad|ipod|iphone/i)){s.contentEditable=true;s.readOnly=false;let range=document.createRange();range.selectNodeContents(s);let sel=window.getSelection();sel.removeAllRanges();sel.addRange(range);s.setSelectionRange(0,999999);}else{s.select();};try{document.execCommand('copy');this.notify("Copied to clipboard",s.value);}catch(e){};s.remove();},viewDeposits(){this.pages.deposits=1;},closeDeposits(){this.pages.deposits=0;},formatCrypto(val,dec=4){return isNaN(val)?"...":(Math.round(val*10**dec)/10**dec).toFixed(dec);},prettifyAmount(n){var ranges=[{divider:1e18,suffix:'E'},{divider:1e15,suffix:'P'},{divider:1e12,suffix:'T'},{divider:1e9,suffix:'B'},{divider:1e6,suffix:'M'},{divider:1e3,suffix:'K'}];for(var i=0;i<ranges.length;i++){if(n>=ranges[i].divider){n=Math.floor(n/(ranges[i].divider/100))/100;return n.toString()+ranges[i].suffix;}};return n.toString();},countdown(end){var now=new Date().getTime();var timeleft=end-now;var days=Math.floor(timeleft/(1000*60*60*24));var hours=Math.floor((timeleft%(1000*60*60*24))/(1000*60*60));var minutes=Math.floor((timeleft%(1000*60*60))/(1000*60));var seconds=Math.floor((timeleft%(1000*60))/1000);hours=(days*24)+hours;if(hours<10)hours="0"+hours;if(minutes<10)minutes="0"+minutes;if(seconds<10)seconds="0"+seconds;return{hours:hours,minutes:minutes,seconds:seconds};},prettyDate(e){if(e<100)return"No record";if(e<16e10)e*=1e3;return window.countdown(e);},updateUserData(from,to,i,data){from=parseFloat(from);to=parseFloat(to);let self=this;let t=2940;let x=60;if(i<t/x&&self.userRequests>2&&from<to){let v=i*((to-from)/(t/x));self.user[data]=from+v;clearTimeout(self.userTimeouts[data]);self.userTimeouts[data]=setTimeout(function(){self.updateUserData(from,to,i+1,data);},x);}else{self.user[data]=to;}},updateContractData(from,to,i,data){from=parseFloat(from);to=parseFloat(to);let self=this;let t=1200;let x=60;if(i<t/x&&self.contractRequests>2&&from<to){let v=i*((to-from)/(t/x));self.contract[data]=from+v;clearTimeout(self.contractTimeouts[data]);self.contractTimeouts[data]=setTimeout(function(){self.updateContractData(from,to,i+1,data);},x);}else{self.contract[data]=to;}},fetchData(){try{if(!this.public){this.getUserInfo();this.getContractInfo();}else{this.getEvents();}}catch(e){this.getEvents();}},getEvents(){let self=this;this.contractRequests++;(async()=>{try{let e=await self.trsc._getEvents();if(e.length>0&&e[0].name=="ContractDetails"){let res=e[0].result;self.contract.totalDeposits=res.totalDeposits/1e6;self.contract.totalWithdrawals=res.totalWithdrawals/1e6;self.contract.totalRefBonus=res.totalRefBonus/1e6;self.contract.totalUsers=res.totalUsers;self.contract.balance=res.contractBalance/1e6;console.log("Public details updated");}}catch(e){}})();},getContractInfo(){let self=this;self.contractRequests++;self.trsc.getContractInfo().call().then(res=>{self.contract.totalDeposits=res._totalDeposits/1e6;self.contract.totalWithdrawals=res._totalWithdrawals/1e6;self.contract.totalRefBonus=res._totalRefBonus/1e6;self.contract.totalUsers=res._totalUsers;self.contract.balance=res._contractBalance/1e6;}).catch(e=>{console.log("E! getContractInfo");console.log(e);});},getUserInfo(){let self=this;self.userRequests++;try{self.trsc.tronWeb.trx.getBalance(self.tron.account).then(res=>{self.user.wallet=self.formatCrypto(res/1e6);});self.trsc.getUserInfo(self.tron.account).call().then(res=>{self.user.totalDeposits=res._totalDeposits/1e6;self.user.totalWithdrawn=res._totalWithdrawn/1e6;self.user.depositCount=res._numberOfDeposits;self.user.totalReferrals=res._totalReferrals/1e6;self.user.dailyRate=res._dailyRate/1e6;self.user.totalWithdrawable=res._userWithdrawable/1e6;self.user.lastWithdraw=res._userCheckpoint;}).catch(e=>{console.log("E! getUserInfo [1]");console.log(e);});self.trsc.getUserReferralInfo(self.tron.account).call().then(res=>{self.user.bonus=res.bonus/1e6;self.user.totalBonus=res.totalBonus/1e6;res=res.referrals;for(let i=0;i<res.length;i++){self.user.referrals[i]=res[i];}}).catch(e=>{console.log("E! getUserInfo [2]");console.log(e);});}catch(e){self.public=1;}},getUserDeposits(){let self=this;let fetch=(i)=>{if(self.pages.deposits==0){setTimeout(self.getUserDeposits,500);}else{try{self.trsc.getUserDepositInfo(self.tron.account,i).call().then(res=>{let profit=0;let amt=res.amount/1e6;switch(res.plan.toString()){case"1":case"2":case"5":profit=amt*res.rate*(self.currentTime()-res.start)/864e6;break;case"3":if(1||self.currentTime()>=res.finish){profit=amt*res.rate*20/1e4;};break;case"4":if(1||self.currentTime()>=res.finish){profit=amt*res.rate*25/1e4;};break;};profit=profit.toFixed(4)+" TRX ("+(profit/amt*100).toFixed(2)+"%)";let plan=res.plan.toString()=="5"?"reinvested":"plan "+res.plan;self.user.deposits[i]={amount:amt,plan:plan,rate:res.rate,start:res.start,finish:res.finish,profit:profit,countdown:res.finish<self.currentTime()?"FINISHED":self.countdown(res.finish*1e3)};i++;if(i<parseInt(self.user.depositCount)){fetch(i);}else{setTimeout(self.getUserDeposits,2000);}}).catch(e=>{});}catch(e){setTimeout(self.getUserDeposits,2000);}}};fetch(0);},getEventData(txid,name,next){let self=this;self.tron.tronWeb.getEventByTransactionID(txid).then(res=>{for(let i=0;i<res.length;i++){if(res[i].name==name){next(res[i].result);}}});},plan1(){let self=this;let amount=self.calc.plan1;if(amount<=self.calc.max&&amount>=200){self.notify("Confirm Transaction","Depositing "+amount+" TRX in PLAN 1");self.trsc.investPlan1(self.user.ref).send({callValue:amount*1e6,shouldPollResponse:true}).then(res=>{console.log(res);self.notify("Deposit Successful!",'',6e5);}).catch(e=>{try{let txid=e.transaction.txID;self.getEventData(txid,"NewDeposit",res=>{self.notify("Deposit Successful!","Plan "+res.plan+" with "+res.rate/100+"% Daily",6e5);});}catch(e){self.notify("Transaction Cancelled.");}});}else{self.notify("Amount is invalid!");}},plan2(){let self=this;let amount=self.calc.plan2;if(amount<=self.calc.max&&amount>=200){self.notify("Confirm Transaction","Depositing "+amount+" TRX in PLAN 2");self.trsc.investPlan2(self.user.ref).send({callValue:amount*1e6,shouldPollResponse:true}).then(res=>{console.log(res);self.notify("Deposit Successful!",'',6e5);}).catch(e=>{try{let txid=e.transaction.txID;self.getEventData(txid,"NewDeposit",res=>{self.notify("Deposit Successful!","Plan "+res.plan+" with "+res.rate/100+"% Daily",6e5);});}catch(e){self.notify("Transaction Cancelled.");}});}else{self.notify("Amount is invalid!");}},plan3(){let self=this;let amount=self.calc.plan3;if(amount<=self.calc.max&&amount>=500){self.notify("Confirm Transaction","Depositing "+amount+" TRX in PLAN 3");self.trsc.investPlan3(self.user.ref).send({callValue:amount*1e6,shouldPollResponse:true}).then(res=>{console.log(res);self.notify("Deposit Successful!",'',6e5);}).catch(e=>{try{let txid=e.transaction.txID;self.getEventData(txid,"NewDeposit",res=>{self.notify("Deposit Successful!","Plan "+res.plan+" with "+res.rate/100+"% Daily",6e5);});}catch(e){self.notify("Transaction Cancelled.");}});}else{self.notify("Amount is invalid!");}},plan4(){let self=this;let amount=self.calc.plan4;if(amount<=self.calc.max&&amount>=500){self.notify("Confirm Transaction","Depositing "+amount+" TRX in PLAN 4");self.trsc.investPlan4(self.user.ref).send({callValue:amount*1e6,shouldPollResponse:true}).then(res=>{console.log(res);self.notify("Deposit Successful!",'',6e5);}).catch(e=>{try{let txid=e.transaction.txID;self.getEventData(txid,"NewDeposit",res=>{self.notify("Deposit Successful!","Plan "+res.plan+" with "+res.rate/100+"% Daily",6e5);});}catch(e){self.notify("Transaction Cancelled.");}});}else{self.notify("Amount is invalid!");}},reinvest(){let self=this;let amount=self.user.totalWithdrawable;if(amount>0){self.notify("Confirm Transaction","Reinvesting ~"+self.user.totalWithdrawable+" TRX");self.trsc.reinvest().send({shouldPollResponse:true}).then(res=>{console.log(res);self.notify("Reinvest Successful!","Successfully reinvested "+res.amount/1e6+" TRX",6e5);}).catch(e=>{try{let txid=e.transaction.txID;self.getEventData(txid,"Withdraw",res=>{self.notify("Reinvest Successful!","Successfully reinvested "+res.amount/1e6+" TRX",6e5);});}catch(e){self.notify("Transaction Cancelled.");}});}else{self.notify("Nothing to reinvest!");}},withdraw(){let self=this;let amount=self.user.totalWithdrawable;if(amount>0){self.notify("Confirm Transaction","Withdrawing ~"+self.user.totalWithdrawable+" TRX");self.trsc.withdraw().send({shouldPollResponse:true}).then(res=>{console.log(res);self.notify("Withdraw Successful!","Successfully withdrawn "+res.amount/1e6+" TRX",6e5);}).catch(e=>{try{let txid=e.transaction.txID;self.getEventData(txid,"Withdraw",res=>{self.notify("Withdraw Successful!","Successfully withdrawn "+res.amount/1e6+" TRX",6e5);});}catch(e){self.notify("Transaction Cancelled.");}});}else{self.notify("Nothing to withdraw!");}},claimBonus(){let self=this;if(self.user.bonus<=0){self.notify("No bonus available!");return;};self.notify("Confirm Transaction","Claiming Ref Bonus of "+self.user.bonus+" TRX");self.trsc.claimReferral().send({shouldPollResponse:true}).then(res=>{self.notify("Claimed "+res.amount/1e6+" TRX Ref Bonus",'',6e5);console.log(res.amount);}).catch(e=>{console.log("E! claimBonus error");try{let txid=e.transaction.txID;self.getEventData(txid,"RefClaim",res=>{self.notify("Claimed "+res.amount/1e6+" TRX Ref Bonus",'',6e5);});}catch(e){self.notify("Transaction Cancelled!");}});}}});})();